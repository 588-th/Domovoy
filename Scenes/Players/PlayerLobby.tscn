[gd_scene load_steps=32 format=3 uid="uid://7fa0b3shof4a"]

[ext_resource type="Script" path="res://Scripts/Player/PlayerInputVector.cs" id="1_1rug0"]
[ext_resource type="Script" path="res://Scripts/AudioPlayer.cs" id="1_4resh"]
[ext_resource type="ArrayMesh" uid="uid://b2mb176k0pcgp" path="res://Meshes/HiddenCollection_BowlingPin.res" id="1_w8yps"]
[ext_resource type="Script" path="res://Scripts/Player/InputVector.cs" id="1_xdgfg"]
[ext_resource type="Script" path="res://Scripts/Player/InputActions.cs" id="2_tndgs"]
[ext_resource type="Script" path="res://Scripts/Player/PlayerInputKeys.cs" id="4_63mi2"]
[ext_resource type="Script" path="res://Scripts/Player/PlayerCamera.cs" id="4_in0gx"]
[ext_resource type="PackedScene" uid="uid://c131mixukwjnm" path="res://Scenes/UserInterface/Menu/UIPauseMenu.tscn" id="5_0kvk8"]
[ext_resource type="Script" path="res://Scripts/Player/MovementActions.cs" id="5_2oygj"]
[ext_resource type="PackedScene" uid="uid://cojvgyniobwbk" path="res://Scenes/UserInterface/HUD/UICrosshair.tscn" id="7_jm5rm"]
[ext_resource type="Script" path="res://Scripts/Player/Movement/PlayerMovement.cs" id="8_2bsv7"]
[ext_resource type="Script" path="res://Scripts/Player/PlayerCameraAnimations.cs" id="9_1j4wq"]
[ext_resource type="Script" path="res://Scripts/Player/PropInteract/PlayerPropInteractor.cs" id="11_cuem1"]
[ext_resource type="PackedScene" uid="uid://dneigjq1nfs2b" path="res://Scenes/UserInterface/Menu/UIPlayerList.tscn" id="12_ylh5w"]
[ext_resource type="PackedScene" uid="uid://bdau24iq4fib8" path="res://Scenes/UserInterface/HUD/UIVignette.tscn" id="13_fsu3j"]
[ext_resource type="Resource" uid="uid://by7ti8k7bsiet" path="res://ScriptableObjects/PlayerMovementParameters.tres" id="13_xi3vn"]
[ext_resource type="Script" path="res://Scripts/Player/RemoteCameraRotation.cs" id="14_2swan"]
[ext_resource type="PackedScene" uid="uid://cq70khnyefibk" path="res://Scenes/UserInterface/HUD/UIDithering.tscn" id="14_46ehg"]
[ext_resource type="Script" path="res://Scripts/Player/Movement/PlayerMovementSounds.cs" id="19_l34sy"]
[ext_resource type="AudioStream" uid="uid://cwuox5lt45k24" path="res://Audio/SFX/Step.mp3" id="20_utodw"]
[ext_resource type="AudioStream" uid="uid://3jamu0u0vmak" path="res://Audio/SFX/Common/Jump.mp3" id="21_e37e1"]
[ext_resource type="AudioStream" uid="uid://gmsohkdgi4p5" path="res://Audio/SFX/Common/Landing.mp3" id="22_ux476"]

[sub_resource type="CylinderShape3D" id="CylinderShape3D_e1mld"]
radius = 0.3

[sub_resource type="Animation" id="Animation_xhoir"]
resource_name = "IDLE"
loop_mode = 1
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../../CommonPart/CameraHolder/PlayerCamera:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector3(0, 0, 0), Vector3(0, 0, 0)]
}

[sub_resource type="Animation" id="Animation_aldqb"]
resource_name = "JUMP"
step = 0.05

[sub_resource type="Animation" id="Animation_r6j44"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../../CommonPart/CameraHolder/PlayerCamera:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 0, 0)]
}

[sub_resource type="Animation" id="Animation_ybvy8"]
resource_name = "WALK"
length = 1.6
loop_mode = 1
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../../CommonPart/CameraHolder/PlayerCamera:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4, 0.8, 1.2, 1.6),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 0, 0), Vector3(0.03, 0.04, 0), Vector3(0, 0, 0), Vector3(-0.03, 0.04, 0), Vector3(0, 0, 0)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_vvpui"]
_data = {
"IDLE": SubResource("Animation_xhoir"),
"JUMP": SubResource("Animation_aldqb"),
"RESET": SubResource("Animation_r6j44"),
"WALK": SubResource("Animation_ybvy8")
}

[sub_resource type="SceneReplicationConfig" id="SceneReplicationConfig_ghvew"]
properties/0/path = NodePath(".:Vector")
properties/0/spawn = true
properties/0/replication_mode = 2

[sub_resource type="SceneReplicationConfig" id="SceneReplicationConfig_mj3mr"]
properties/0/path = NodePath(".:position")
properties/0/spawn = true
properties/0/replication_mode = 2
properties/1/path = NodePath(".:rotation")
properties/1/spawn = true
properties/1/replication_mode = 2

[sub_resource type="SceneReplicationConfig" id="SceneReplicationConfig_bnnxu"]
properties/0/path = NodePath(".:position")
properties/0/spawn = true
properties/0/replication_mode = 2
properties/1/path = NodePath(".:rotation")
properties/1/spawn = true
properties/1/replication_mode = 2

[node name="PlayerLobby" type="Node" groups=["Player"]]
metadata/PlayerCamera = NodePath("CommonPart/CameraHolder/PlayerCamera")

[node name="CommonPart" type="Node" parent="."]

[node name="AudioPlayer" type="Node" parent="CommonPart" node_paths=PackedStringArray("_playerRoot", "_audioStreamPlayer", "_audioStreamPlayer3D")]
script = ExtResource("1_4resh")
_playerRoot = NodePath("../..")
_audioStreamPlayer = NodePath("../../ClientServerPart/AudioStreamPlayer")
_audioStreamPlayer3D = NodePath("../AudioStreamPlayer3D")

[node name="CameraHolder" type="Node3D" parent="CommonPart"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, -5.32905e-15)

[node name="PlayerCamera" type="Camera3D" parent="CommonPart/CameraHolder"]

[node name="PlayerLook" type="Node3D" parent="CommonPart/CameraHolder/PlayerCamera"]

[node name="RayOfLook" type="RayCast3D" parent="CommonPart/CameraHolder/PlayerCamera/PlayerLook"]
target_position = Vector3(0, 0, -2.5)
collision_mask = 262
hit_back_faces = false

[node name="anchorHoldingItem" type="Marker3D" parent="CommonPart/CameraHolder/PlayerCamera/PlayerLook"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.41989, -0.13983, -1.11052)

[node name="ObjectInteraction" type="Node3D" parent="CommonPart/CameraHolder/PlayerCamera/PlayerLook"]

[node name="anchorForDraggedObject" type="Marker3D" parent="CommonPart/CameraHolder/PlayerCamera/PlayerLook/ObjectInteraction"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1.5)

[node name="StaticBody3D" type="StaticBody3D" parent="CommonPart/CameraHolder/PlayerCamera/PlayerLook/ObjectInteraction"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1.5)

[node name="Generic6DOFJoint3D" type="Generic6DOFJoint3D" parent="CommonPart/CameraHolder/PlayerCamera/PlayerLook/ObjectInteraction"]
node_a = NodePath("../StaticBody3D")
linear_limit_x/enabled = false
linear_limit_y/enabled = false
linear_limit_z/enabled = false

[node name="PlayerBody" type="CharacterBody3D" parent="CommonPart" groups=["Hitbox:Player"]]
transform = Transform3D(1, 0, 0, 0, 1, 1.06581e-14, 0, -1.06581e-14, 1, 0, 0, 0)
collision_layer = 256
collision_mask = 259
floor_max_angle = 1.0472
metadata/PlayerRoot = NodePath("../..")

[node name="Model" type="MeshInstance3D" parent="CommonPart/PlayerBody"]
transform = Transform3D(5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0.125, 0)
cast_shadow = 0
mesh = ExtResource("1_w8yps")

[node name="Hitbox" type="CollisionShape3D" parent="CommonPart/PlayerBody"]
shape = SubResource("CylinderShape3D_e1mld")

[node name="Achors" type="Node3D" parent="CommonPart/PlayerBody"]

[node name="achorCamera" type="Marker3D" parent="CommonPart/PlayerBody/Achors"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="RemotePositionToCamera" type="RemoteTransform3D" parent="CommonPart/PlayerBody/Achors/achorCamera"]
remote_path = NodePath("../../../../CameraHolder")
update_rotation = false
update_scale = false

[node name="anchorPrimatyItem" type="Marker3D" parent="CommonPart/PlayerBody/Achors"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, -0.25, 0.35)

[node name="anchorSecondaryItem" type="Marker3D" parent="CommonPart/PlayerBody/Achors"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0.35, -0.25, 0)

[node name="anchorTertiaryItem" type="Marker3D" parent="CommonPart/PlayerBody/Achors"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, -0.35, -0.25, 0)

[node name="AudioStreamPlayer3D" type="AudioStreamPlayer3D" parent="CommonPart"]
max_polyphony = 4
bus = &"SFX"

[node name="ClientServerPart" type="Node" parent="."]

[node name="Scripts" type="Node" parent="ClientServerPart"]

[node name="InputActions" type="Node" parent="ClientServerPart/Scripts"]
script = ExtResource("2_tndgs")

[node name="InputVector" type="Node" parent="ClientServerPart/Scripts"]
script = ExtResource("1_xdgfg")

[node name="MovementActions" type="Node" parent="ClientServerPart/Scripts" node_paths=PackedStringArray("_playerRoot")]
script = ExtResource("5_2oygj")
_playerRoot = NodePath("../../..")

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="ClientServerPart"]
max_polyphony = 4
bus = &"SFX"

[node name="ClientPart" type="Node" parent="."]

[node name="Scripts" type="Node" parent="ClientPart"]

[node name="PlayerInputKeys" type="Node" parent="ClientPart/Scripts" node_paths=PackedStringArray("_inputActions")]
script = ExtResource("4_63mi2")
_inputActions = NodePath("../../../ClientServerPart/Scripts/InputActions")

[node name="PlayerInputVector" type="Node" parent="ClientPart/Scripts" node_paths=PackedStringArray("_inputVector")]
script = ExtResource("1_1rug0")
_inputVector = NodePath("../../../ClientServerPart/Scripts/InputVector")

[node name="PlayerCamera" type="Node" parent="ClientPart/Scripts" node_paths=PackedStringArray("_playerCamera")]
script = ExtResource("4_in0gx")
_playerCamera = NodePath("../../../CommonPart/CameraHolder/PlayerCamera")

[node name="PlayerCameraAnimation" type="Node" parent="ClientPart/Scripts" node_paths=PackedStringArray("_movementActions", "_animationPlayer")]
script = ExtResource("9_1j4wq")
_movementActions = NodePath("../../../ClientServerPart/Scripts/MovementActions")
_animationPlayer = NodePath("../PlayerCameraAnimator")

[node name="PlayerCameraAnimator" type="AnimationPlayer" parent="ClientPart/Scripts"]
libraries = {
"": SubResource("AnimationLibrary_vvpui")
}
blend_times = [&"IDLE", &"WALK", 0.5, &"WALK", &"IDLE", 0.2]

[node name="UI" type="Node" parent="ClientPart"]

[node name="UIPauseMenu" parent="ClientPart/UI" node_paths=PackedStringArray("_inputActions") instance=ExtResource("5_0kvk8")]
mouse_filter = 1
_inputActions = NodePath("../../../ClientServerPart/Scripts/InputActions")

[node name="UIPlayerList" parent="ClientPart/UI" node_paths=PackedStringArray("_inputActions") instance=ExtResource("12_ylh5w")]
_inputActions = NodePath("../../../ClientServerPart/Scripts/InputActions")

[node name="UICrosshair" parent="ClientPart/UI" instance=ExtResource("7_jm5rm")]

[node name="UIVignette" parent="ClientPart/UI" instance=ExtResource("13_fsu3j")]

[node name="UIDithering" parent="ClientPart/UI" instance=ExtResource("14_46ehg")]

[node name="ServerPart" type="Node" parent="."]

[node name="Scripts" type="Node" parent="ServerPart"]

[node name="PlayerMovement" type="Node" parent="ServerPart/Scripts" node_paths=PackedStringArray("MovementActions", "InputActions", "InputVector", "PlayerBody")]
script = ExtResource("8_2bsv7")
MovementActions = NodePath("../../../ClientServerPart/Scripts/MovementActions")
InputActions = NodePath("../../../ClientServerPart/Scripts/InputActions")
InputVector = NodePath("../../../ClientServerPart/Scripts/InputVector")
PlayerBody = NodePath("../../../CommonPart/PlayerBody")
PlayerMovementParameters = ExtResource("13_xi3vn")

[node name="PlayerPropInteractor" type="Node" parent="ServerPart/Scripts" node_paths=PackedStringArray("_inputActions", "RayOfLook", "PlayerBody", "AnchorForDraggedObject", "StaticBody3D", "Generic6DofJoint3D")]
script = ExtResource("11_cuem1")
_inputActions = NodePath("../../../ClientServerPart/Scripts/InputActions")
RayOfLook = NodePath("../../../CommonPart/CameraHolder/PlayerCamera/PlayerLook/RayOfLook")
PlayerBody = NodePath("../../../CommonPart/PlayerBody")
AnchorForDraggedObject = NodePath("../../../CommonPart/CameraHolder/PlayerCamera/PlayerLook/ObjectInteraction/anchorForDraggedObject")
StaticBody3D = NodePath("../../../CommonPart/CameraHolder/PlayerCamera/PlayerLook/ObjectInteraction/StaticBody3D")
Generic6DofJoint3D = NodePath("../../../CommonPart/CameraHolder/PlayerCamera/PlayerLook/ObjectInteraction/Generic6DOFJoint3D")

[node name="RemoteCameraRotation" type="Node" parent="ServerPart/Scripts" node_paths=PackedStringArray("_playerCamera", "_playerBody")]
script = ExtResource("14_2swan")
_playerCamera = NodePath("../../../CommonPart/CameraHolder/PlayerCamera")
_playerBody = NodePath("../../../CommonPart/PlayerBody")

[node name="PlayerMovementSound" type="Node" parent="ServerPart/Scripts" node_paths=PackedStringArray("_movementActions", "_audioPlayer", "_stepTimer")]
script = ExtResource("19_l34sy")
_movementActions = NodePath("../../../ClientServerPart/Scripts/MovementActions")
_audioPlayer = NodePath("../../../CommonPart/AudioPlayer")
_stepTimer = NodePath("../../Timer")
_stepInterval = 0.8
_stepAudio = ExtResource("20_utodw")
_jumpAudio = ExtResource("21_e37e1")
_landAudio = ExtResource("22_ux476")

[node name="Timer" type="Timer" parent="ServerPart"]

[node name="Synchronizers" type="Node" parent="."]

[node name="InputVectorSynchronizer" type="MultiplayerSynchronizer" parent="Synchronizers"]
root_path = NodePath("../../ClientServerPart/Scripts/InputVector")
replication_config = SubResource("SceneReplicationConfig_ghvew")
public_visibility = false

[node name="PlayerBodySynchronizer" type="MultiplayerSynchronizer" parent="Synchronizers"]
root_path = NodePath("../../CommonPart/PlayerBody")
replication_config = SubResource("SceneReplicationConfig_mj3mr")

[node name="PlayerCameraSynchronizer" type="MultiplayerSynchronizer" parent="Synchronizers"]
root_path = NodePath("../../CommonPart/CameraHolder/PlayerCamera")
replication_config = SubResource("SceneReplicationConfig_bnnxu")
